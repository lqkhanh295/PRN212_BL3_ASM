<Window x:Class="ASM_PRN212_BL3.Views.QuizWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="Học Flashcard - Chế Độ Quiz" 
        Height="720" Width="1000"
        WindowStartupLocation="CenterScreen"
        Background="#F4F7F9"
        UseLayoutRounding="True"
        TextOptions.TextFormattingMode="Display"
        TextOptions.TextRenderingMode="ClearType">

    <Window.Resources>
        <Style x:Key="BaseButtonStyle" TargetType="Button">
            <Setter Property="Padding" Value="20,10"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"  
                                CornerRadius="8"  
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="MatchingModeButtonStyle" TargetType="Button" BasedOn="{StaticResource BaseButtonStyle}">
            <Setter Property="Background" Value="#9B59B6"/>
            <Setter Property="Foreground" Value="White"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#8E44AD"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="LogoutButtonStyle" TargetType="Button" BasedOn="{StaticResource BaseButtonStyle}">
            <Setter Property="Background" Value="#E74C3C"/>
            <Setter Property="Foreground" Value="White"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#C0392B"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="CorrectButtonStyle" TargetType="Button" BasedOn="{StaticResource BaseButtonStyle}">
            <Setter Property="Background" Value="#1ABC9C"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="30,15"/>
            <Setter Property="FontSize" Value="15"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#16A085"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="WrongButtonStyle" TargetType="Button" BasedOn="{StaticResource BaseButtonStyle}">
            <Setter Property="Background" Value="#E67E22"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="30,15"/>
            <Setter Property="FontSize" Value="15"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#D35400"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="NavigationButtonStyle" TargetType="Button" BasedOn="{StaticResource BaseButtonStyle}">
            <Setter Property="Background" Value="#BDC3C7"/>
            <Setter Property="Foreground" Value="#2C3E50"/>
            <Setter Property="Padding" Value="20,12"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Margin" Value="5"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#95A5A6"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="ShuffleButtonStyle" TargetType="Button" BasedOn="{StaticResource BaseButtonStyle}">
            <Setter Property="Background" Value="#3498DB"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="25,12"/>
            <Setter Property="Margin" Value="5"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#2980B9"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="RestartButtonStyle" TargetType="Button" BasedOn="{StaticResource BaseButtonStyle}">
            <Setter Property="Background" Value="White"/>
            <Setter Property="Foreground" Value="#1ABC9C"/>
            <Setter Property="Padding" Value="20,10"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#E0F2F1"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <Grid Margin="25">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <Border Grid.Row="0" Background="White" CornerRadius="15" Padding="25" Margin="0,0,0,30">
            <Border.Effect>
                <DropShadowEffect BlurRadius="25" Opacity="0.1" ShadowDepth="0"/>
            </Border.Effect>
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0">
                    <TextBlock x:Name="txtWelcome" Text="Xin chào, Sinh Viên!" 
                               FontSize="24" FontWeight="Bold" Foreground="#2C3E50"/>
                    <TextBlock Text="Chọn bộ thẻ để bắt đầu học với chế độ ôn luyện!" 
                               FontSize="14" Foreground="#7F8C8D" Margin="0,5,0,0"/>
                </StackPanel>

                <Button x:Name="btnMatchingMode" Grid.Column="1" 
                        Content="Chế độ Ghép thẻ" 
                        Style="{StaticResource MatchingModeButtonStyle}"
                        Margin="0,0,15,0"
                        Click="BtnMatchingMode_Click"/>

                <Button x:Name="btnLogout" Grid.Column="2" 
                        Content="Đăng Xuất" 
                        Style="{StaticResource LogoutButtonStyle}"
                        Click="BtnLogout_Click"/>
            </Grid>
        </Border>

        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="300"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <Border Grid.Column="0" Background="White" CornerRadius="15" Padding="20" Margin="0,0,25,0">
                <Border.Effect>
                    <DropShadowEffect BlurRadius="25" Opacity="0.1" ShadowDepth="0"/>
                </Border.Effect>
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0" Text="📚 Bộ Thẻ Hiện Có" 
                               FontSize="18" FontWeight="Bold" 
                               Foreground="#2C3E50"
                               Margin="0,0,0,15"/>

                    <ListBox x:Name="lstDecks" Grid.Row="1"
                             BorderThickness="0"
                             Background="Transparent"
                             ScrollViewer.VerticalScrollBarVisibility="Auto"
                             SelectionChanged="LstDecks_SelectionChanged">

                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <Border Padding="15" Margin="0,0,0,10" 
                                        Background="#F8F9FA" 
                                        CornerRadius="8"
                                        Cursor="Hand">
                                    <StackPanel>
                                        <TextBlock Text="{Binding Name}" 
                                                   FontSize="16" FontWeight="SemiBold"
                                                   Foreground="#34495E"/>
                                        <TextBlock FontSize="12" Foreground="#95A5A6" Margin="0,5,0,0">
                                            <Run Text="{Binding CardCount, Mode=OneWay}"/>
                                            <Run Text=" thẻ"/>
                                        </TextBlock>
                                    </StackPanel>
                                </Border>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                        <ListBox.ItemContainerStyle>
                            <Style TargetType="ListBoxItem">
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="ListBoxItem">
                                            <Border x:Name="Bd"
                                                    Background="Transparent"
                                                    CornerRadius="8"
                                                    SnapsToDevicePixels="true">
                                                <ContentPresenter />
                                            </Border>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsSelected" Value="True">
                                                    <Setter TargetName="Bd" Property="Background" Value="#E3F2FD"/>
                                                    <Setter TargetName="Bd" Property="BorderBrush" Value="#2196F3"/>
                                                    <Setter TargetName="Bd" Property="BorderThickness" Value="2"/>
                                                    <Setter Property="Panel.ZIndex" Value="1"/>
                                                </Trigger>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter TargetName="Bd" Property="Background" Value="#E8F4F8"/>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                                <Style.Triggers>
                                    <Trigger Property="IsSelected" Value="True">
                                        <Setter Property="Background" Value="Transparent"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </ListBox.ItemContainerStyle>
                    </ListBox>
                </Grid>
            </Border>

            <Border Grid.Column="1" Background="White" CornerRadius="15" Padding="35" Margin="25,0,0,0">
                <Border.Effect>
                    <DropShadowEffect BlurRadius="25" Opacity="0.15" ShadowDepth="0"/>
                </Border.Effect>
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <StackPanel Grid.Row="0" Margin="0,0,0,30">
                        <TextBlock x:Name="txtProgress" Text="Thẻ: 0 / 0" 
                                   FontSize="15" HorizontalAlignment="Center" FontWeight="SemiBold" Foreground="#34495E"/>
                        <ProgressBar x:Name="progressBar" Height="10" Margin="0,10,0,0"
                                     Background="#E0E0E0" 
                                     Foreground="#007ACC"
                                     BorderThickness="0"
                                     Style="{StaticResource {x:Type ProgressBar}}">
                            <ProgressBar.Template>
                                <ControlTemplate TargetType="ProgressBar">
                                    <Grid>
                                        <Border CornerRadius="5" BorderThickness="0" 
                                                Background="{TemplateBinding Background}"/>

                                        <Border x:Name="PART_Indicator" 
                                                HorizontalAlignment="Left" 
                                                Background="{TemplateBinding Foreground}" 
                                                CornerRadius="5"/>
                                    </Grid>
                                </ControlTemplate>
                            </ProgressBar.Template>
                        </ProgressBar>
                    </StackPanel>

                    <Grid Grid.Row="1" VerticalAlignment="Center" HorizontalAlignment="Center">
                        <!-- Removed Viewbox to avoid text blurriness when scaled -->
                        <Border x:Name="cardBorder"
                                Width="550" Height="350"
                                Background="#FAFBFC"
                                CornerRadius="25"
                                Cursor="Hand"
                                MouseLeftButtonDown="CardBorder_Click"
                                Padding="50"
                                SnapsToDevicePixels="True"
                                UseLayoutRounding="True">
                            <Border.RenderTransform>
                                <ScaleTransform x:Name="CardScale" ScaleX="1" ScaleY="1" />
                            </Border.RenderTransform>
                            <Border.RenderTransformOrigin>0.5,0.5</Border.RenderTransformOrigin>

                            <Grid>
                                <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                                    <TextBlock x:Name="txtCardLabel" Text="THUẬT NGỮ"
                                               FontSize="12"
                                               Foreground="#6C7A89"
                                               FontWeight="SemiBold"
                                               HorizontalAlignment="Center"
                                               Margin="0,0,0,25"
                                               TextOptions.TextFormattingMode="Display"
                                               TextOptions.TextRenderingMode="ClearType"/>
                                    <TextBlock x:Name="txtCardContent"
                                               Text="Chọn bộ thẻ để bắt đầu"
                                               FontSize="42"
                                               FontWeight="ExtraBold"
                                               TextWrapping="Wrap"
                                               TextAlignment="Center"
                                               Foreground="#1F2D3D"
                                               MaxWidth="450"
                                               TextOptions.TextFormattingMode="Display"
                                               TextOptions.TextRenderingMode="ClearType"/>
                                    <TextBlock Text="(Click vào thẻ để lật)"
                                               FontSize="13"
                                               Foreground="#95A5A6"
                                               HorizontalAlignment="Center"
                                               Margin="0,30,0,0"
                                               FontStyle="Italic"
                                               TextOptions.TextFormattingMode="Display"
                                               TextOptions.TextRenderingMode="ClearType"/>
                                </StackPanel>
                                <TextBlock x:Name="txtBookmark"
                                           Text="★"
                                           FontSize="36"
                                           Foreground="#F39C12"
                                           HorizontalAlignment="Right"
                                           VerticalAlignment="Top"
                                           Margin="0,-10,-10,0"
                                           Visibility="Collapsed"/>
                            </Grid>
                        </Border>
                    </Grid>

                    <StackPanel Grid.Row="2" Margin="0,40,0,0">
                        <StackPanel Orientation="Horizontal" 
                                    HorizontalAlignment="Center" 
                                    Margin="0,0,0,20"
                                    x:Name="pnlAssessment" 
                                    Visibility="Collapsed">
                            <Button x:Name="btnWrong" 
                                    Content="❌ Chưa Thuộc" 
                                    Style="{StaticResource WrongButtonStyle}"
                                    Margin="15,0"
                                    Click="BtnWrong_Click"/>
                            <Button x:Name="btnCorrect" 
                                    Content="✅ Đã Thuộc" 
                                    Style="{StaticResource CorrectButtonStyle}"
                                    Margin="15,0"
                                    Click="BtnCorrect_Click"/>
                        </StackPanel>

                        <StackPanel Orientation="Horizontal" 
                                    HorizontalAlignment="Center">
                            <Button x:Name="btnPrevious" 
                                    Content="Trước" 
                                    Style="{StaticResource NavigationButtonStyle}"
                                    Click="BtnPrevious_Click"/>

                            <Button x:Name="btnShuffle" 
                                    Content="Trộn Thẻ" 
                                    Style="{StaticResource ShuffleButtonStyle}"
                                    Click="BtnShuffle_Click"/>

                            <Button x:Name="btnNext" 
                                    Content="Sau" 
                                    Style="{StaticResource NavigationButtonStyle}"
                                    Click="BtnNext_Click"/>
                        </StackPanel>
                    </StackPanel>
                </Grid> <!-- Đóng Grid trong Border Grid.Column="1" -->
            </Border>
        </Grid> <!-- Đóng Grid Grid.Row="1" -->

        <Border Grid.Row="2" x:Name="pnlResult" 
                Background="#1ABC9C" 
                CornerRadius="15" 
                Padding="25" 
                Margin="0,30,0,0"
                Visibility="Collapsed">
            <Border.Effect>
                <DropShadowEffect BlurRadius="25" Opacity="0.15" ShadowDepth="0"/>
            </Border.Effect>
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0">
                    <TextBlock x:Name="txtResult" Text="Kết quả: 0/0 (0%)" 
                               FontSize="18" FontWeight="Bold" Foreground="White"/>
                    <TextBlock x:Name="txtResultDetail" Text="" 
                               FontSize="14" Foreground="#E8F8F5" Margin="0,5,0,0"/>
                </StackPanel>

                <Button Grid.Column="1" x:Name="btnRestart" Content="🔄 Học Lại" 
                        Style="{StaticResource RestartButtonStyle}"
                        Click="BtnRestart_Click"/>
            </Grid>
        </Border>
    </Grid>
</Window>
